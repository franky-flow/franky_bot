<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="franky_bot">

  <!-- =========================
       Arguments (editable)
       ========================= -->
  <xacro:arg name="base_length"        default="0.34"/>
  <xacro:arg name="base_width"         default="0.24"/>
  <xacro:arg name="base_height"        default="0.14"/>

  <xacro:arg name="wheel_radius"       default="0.034"/>
  <xacro:arg name="wheel_width"        default="0.030"/>
  <xacro:arg name="wheel_separation"   default="0.275"/>

  <!-- Distances from edges -->
  <xacro:arg name="d_front_wheel"      default="0.082"/>
  <xacro:arg name="d_rear_caster"      default="0.065"/>

  <xacro:arg name="caster_radius"      default="0.015"/>

  <!-- =========================
       Derived properties
       ========================= -->
  <xacro:property name="L" value="$(arg base_length)"/>
  <xacro:property name="W" value="$(arg base_width)"/>
  <xacro:property name="H" value="$(arg base_height)"/>

  <xacro:property name="r_wheel" value="$(arg wheel_radius)"/>
  <xacro:property name="w_wheel" value="$(arg wheel_width)"/>
  <xacro:property name="b"       value="$(arg wheel_separation)"/>

  <!-- Half-dimensions -->
  <xacro:property name="L2" value="${L/2.0}"/>
  <xacro:property name="W2" value="${W/2.0}"/>

  <!-- Computed positions -->
  <!-- wheel axle position from center: x = L/2 - d_front_wheel -->
  <xacro:property name="x_wheel" value="${L2 - float($(arg d_front_wheel))}"/>
  <!-- caster position from center: x = -(L/2 - d_rear_caster) -->
  <xacro:property name="x_caster" value="${-(L2 - float($(arg d_rear_caster)))}"/>

  <xacro:property name="y_left"  value="${ b/2.0}"/>
  <xacro:property name="y_right" value="${-b/2.0}"/>

  <xacro:property name="z_base"   value="${H/2.0}"/>
  <xacro:property name="z_wheel"  value="${r_wheel}"/>
  <xacro:property name="z_caster" value="${float($(arg caster_radius))}"/>

  <!-- =========================
       base_footprint (ground frame)
       ========================= -->
  <link name="base_footprint"/>

  <joint name="base_footprint_to_base_link" type="fixed">
    <parent link="base_footprint"/>
    <child link="base_link"/>
    <!-- base_link centered, lifted by half base height -->
    <origin xyz="0 0 ${z_base}" rpy="0 0 0"/>
  </joint>

  <!-- =========================
       base_link (main body)
       ========================= -->
  <link name="base_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="${L} ${W} ${H}"/>
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="${L} ${W} ${H}"/>
      </geometry>
    </collision>

    <!-- Inertial: placeholder (tune later if you care about Gazebo physics) -->
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="2.0"/>
      <!-- rough inertia; replace with real values if needed -->
      <inertia ixx="0.02" ixy="0.0" ixz="0.0"
               iyy="0.03" iyz="0.0"
               izz="0.04"/>
    </inertial>
  </link>

  <!-- =========================
       Wheel macro
       ========================= -->
  <xacro:macro name="wheel_link" params="name">
    <link name="${name}">
      <visual>
        <!-- Cylinder axis is Z in URDF; rotate so it looks like a wheel (axis along Y) -->
        <origin xyz="0 0 0" rpy="1.57079632679 0 0"/>
        <geometry>
          <cylinder radius="${r_wheel}" length="${w_wheel}"/>
        </geometry>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="1.57079632679 0 0"/>
        <geometry>
          <cylinder radius="${r_wheel}" length="${w_wheel}"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.2"/>
        <inertia ixx="0.0002" ixy="0.0" ixz="0.0"
                 iyy="0.0002" iyz="0.0"
                 izz="0.0002"/>
      </inertial>
    </link>
  </xacro:macro>

  <!-- Left wheel -->
  <xacro:wheel_link name="left_wheel_link"/>
  <joint name="left_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="left_wheel_link"/>
    <origin xyz="${x_wheel} ${y_left} ${z_wheel}" rpy="0 0 0"/>
    <!-- Wheel rotates around Y (left-right axis) -->
    <axis xyz="0 1 0"/>
  </joint>

  <!-- Right wheel -->
  <xacro:wheel_link name="right_wheel_link"/>
  <joint name="right_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="right_wheel_link"/>
    <origin xyz="${x_wheel} ${y_right} ${z_wheel}" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- =========================
       Caster (simple visual)
       ========================= -->
  <link name="caster_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <!-- Represent caster as sphere (good enough for RViz) -->
        <sphere radius="$(arg caster_radius)"/>
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="$(arg caster_radius)"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.1"/>
      <inertia ixx="0.00005" ixy="0.0" ixz="0.0"
               iyy="0.00005" iyz="0.0"
               izz="0.00005"/>
    </inertial>
  </link>

  <joint name="caster_joint" type="fixed">
    <parent link="base_link"/>
    <child link="caster_link"/>
    <origin xyz="${x_caster} 0 ${z_caster}" rpy="0 0 0"/>
  </joint>

</robot>
